---
title: "Climbing Insights"
author: "Ian McDonald"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---
#Intro
Welcome to my data science project. The data I chose to examine for this was a dataset that was scraped from 8a.nu. This is a popular website used by rock climbers. 8a.nu offers a feature that allows users to log the climbs that they have completed. Additionally there is user data included that has information about the climbers who logged these climbs. As a rock climber myself, this data interested me as I hoped to learn a little bit more about climbers, but also learn more about climbing areas and individual climbs.

# Setup

installing packages needed
```{r}
install.packages("tidyverse")
install.packages("RSQLite")
install.packages("RColorBrewer")
install.packages("ggplot")
```

loading libraries that we installed
```{r}
library("tidyverse")
library("RSQLite")
library(ggplot2)
library("RColorBrewer")
```

Creating a connection to the database we will be using. This database houses all of the user entered data the was taken from 8a.nu
```{r}
con <- dbConnect(RSQLite::SQLite(), "database.sqlite")
dbListTables(con)
```

#Gather All Data
We are first going to grab all data from each table and store them in a dataframe.
Right now our data is in the form of 4 tables store in an sqlite database. We will be sending a query to this database asking for each table one by one and creating dataframes from these results.
```{r}

ascents <- dbGetQuery(con, "SELECT * FROM ASCENT;")
grades <- dbGetQuery(con, "SELECT * FROM GRADE");
methods <- dbGetQuery(con, "SELECT * FROM METHOD;")
users <- dbGetQuery(con, "SELECT * FROM USER;")

```

#Time to Clean and Tidy Data

##First lets look at the Users Dataframe we created.
```{r}
dim(users)
colnames(users)
```
Cleaning user dataframe.
First we take all values in the height and weight and started columns and replace them with N/A value
Then we need to take all empty valus in the remaining tables string fields and replace empty strings with na values

Finally we create a tibble that will have the data we are going to be most interested in from this table.
```{r}
colnames(users)[colnames(users) == 'id'] <- 'user_id'
users[, 7:9][users[,7:9]==0] <- NA
users[, 10:20][users[,10:20]==""] <- NA
userInfo <- dplyr::tibble(id=users$user_id, height=users$height, weight=users$weight, city=users$city, country=users$country, year_started=users$started, occupation=users$occupation, birthday=users$birth)
```

##Next Looking at the ascent table
A lot of data in this table is specific to what we are deciding to look at. We will need to clean a lot of this data.
```{r}
dim(ascents)
colnames(ascents)
```
#Early Exploration

Plot number of climbs logged at each different grade as a bar chart
```{r}
plot <- ggplot(ascents, aes(x=grade_id)) + geom_bar() + xlab("Grade") + ylab("Number of Logged Climbs")
plot
```

```{r}
hardestClimb <- ascents %>% group_by(user_id) %>% top_n(1, grade_id)
hardestWithYear <- merge(hardestClimb,users, by="user_id")
startPlot <- ggplot(hardestWithYear, aes(x=started,y=grade_id)) + geom_point() +  xlim(1950, 2019)
startPlot
```

```{r}
res <- dbGetQuery(con, "SELECT country, count(id) from user group by country order by count(id) desc limit 10;")
p<-ggplot(data=res, aes(x=reorder(country, -res$`count(id)`), y=res$`count(id)`)) + geom_bar(stat="identity") + xlab("Country of Residence") + ylab("Number of Climbers")
p
```
